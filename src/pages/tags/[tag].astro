---
import BlogPostListingLayout from "../../layouts/BlogPostListingLayout.astro";

export async function getStaticPaths() {
  
  const allPosts = await Astro.glob('../*.md'); // returns an array of posts from location specified
  
  const allTags = new Set()
 
  allPosts.map(post => {
      post.frontmatter.tags && post.frontmatter.tags.map(tag => allTags.add(tag.toLowerCase()))
  })


  return Array.from(allTags).map((tag) => {
    const filteredPosts = allPosts.filter((post) => post.frontmatter.tags.includes(tag))
    
    return filteredPosts.map((post) => ({
        params: { tag },
        props: { filteredPosts }
    }))
  })
}

const { tag } = Astro.params
const { filteredPosts } = Astro.props
---
<BlogPostListingLayout>

<div>
<h1>Blog posts with {tag} in tags</h1>
<ul>
  {filteredPosts.map((post) => (
        <li>{post.frontmatter.title}</li>
  ))}
</ul>
</div>

 </BlogPostListingLayout>
  










